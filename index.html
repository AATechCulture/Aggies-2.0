<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
<title>Keep Up</title>
</head>
<body>
<div class="container">
<div class="header">
<h1>Keep Up!</h1>
<div class="calendar">
<h3>{{ current_date }}</h3>
</div>
</div>


<div class="snackbar" id="snackbar">
<span>Important updates will appear here</span>
<button onclick="closeSnackbar()">Ã—</button>
</div>


<div class="current-day">
<h2>Today's Tasks</h2>
<div class="todo-item">
<label for="task1"><input type="checkbox" id="task1" onclick='updateStreak()'> {{ first_event }}</label>
</div>
</div>


<div class="events-today">
<h2>Upcoming Events</h2>
{% if upcoming_events %}
<ul>
{% for event in upcoming_events %}
<li>{{ event }}</li>
{% endfor %}
</ul>
{% else %}
<p>No upcoming events.</p>
{% endif %}
</div>


<div class="chatbot">
<div id="chat">
<h2>Chat with PlannerBot: </h2>
<p> What's your plans for the Week?</p>
<div id="messages"></div>
<form id="chat-form">
<input type="text" id="user_input" placeholder="Enter your activity here..." required>
<button type="submit">Send</button>
</form>
</div>
</div>
</div>


<script>
function closeSnackbar() {
document.querySelector('.snackbar').style.display = 'none';
}


const form = document.getElementById('chat-form');
const messagesDiv = document.getElementById('messages');


form.addEventListener('submit', function(e) {
e.preventDefault();
const userInput = document.getElementById('user_input').value;


// Display user input
const userMessage = document.createElement('div');
userMessage.className = 'message user-message';
userMessage.textContent = `You: ${userInput}`;
messagesDiv.appendChild(userMessage);


// Send the user input to the backend
fetch('/ask', {
method: 'POST',
headers: {'Content-Type': 'application/x-www-form-urlencoded'},
body: `user_input=${encodeURIComponent(userInput)}`
})
.then(response => response.json())
.then(data => {
const botMessage = document.createElement('div');
botMessage.className = 'message bot-message';
botMessage.textContent = `Bot: ${data.response}`;
messagesDiv.appendChild(botMessage);


// Scroll to the bottom of the chat
messagesDiv.scrollTop = messagesDiv.scrollHeight;
});


// Clear the input field
document.getElementById('user_input').value = '';
});
// tracks task completion for streak update
const checkboxes = document.querySelectorAll('input[type="checkbox"]');
const output = document.querySelector('.snackbar span');


const total = checkboxes.length;
const arr = [false, false, false];
function updateStreak(){
window.addEventListener('change', function () {
for(let i = 0; i < checkboxes.length; i++)
{
if(checkboxes[i].checked)
{
arr[i] = true;
}
}
const allTrue = arr.every(Boolean);
//output.textContent = arr;
if(allTrue){
output.textContent = 'Streak: 1';
}
//alert("It's changed!")
});
}
const calendar = document.getElementById('calendar');


async function fetchTasks() {
const response = await fetch('/get-tasks');
const tasks = await response.json();


const taskData = tasks.reduce((acc, task) => {
const date = task.date_time.split(' ')[0]; // Assuming `date_time` is "YYYY-MM-DD HH:MM"
if (!acc[date]) acc[date] = [];
acc[date].push(task.task);
return acc;
}, {});


renderCalendar(taskData);
}


function renderCalendar(taskData) {
const daysInMonth = 30; // Assuming November
const firstDayOfWeek = 3; // Wednesday (0 = Sunday, 1 = Monday, ...)


for (let i = 0; i < firstDayOfWeek; i++) {
const emptyDiv = document.createElement('div');
emptyDiv.classList.add('day', 'empty');
calendar.appendChild(emptyDiv);
}


for (let day = 1; day <= daysInMonth; day++) {
const date = `2024-11-${String(day).padStart(2, '0')}`;
const dayDiv = document.createElement('div');
dayDiv.classList.add('day');
dayDiv.textContent = day;


if (taskData[date]) {
const taskCount = document.createElement('span');
taskCount.textContent = `${taskData[date].length} Task(s)`;
dayDiv.appendChild(taskCount);
}


calendar.appendChild(dayDiv);
}
}


fetchTasks();


</script>
</body>
</html>

